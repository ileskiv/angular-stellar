/*! angular-stellar - v0.1.2 - 2014-01-11
 * https://github.com/tomchentw/angular-stellar
 * Copyright (c) 2014 [tomchentw](https://github.com/tomchentw/);
 * Licensed [MIT](http://tomchentw.mit-license.org/)
 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l;a=angular.bind,b=angular.noop,c=angular.element,d=angular.extend,e=1e3/60,f=["$window","$log"].concat(function(b,c){var d,f,g,h,i;for(d=["request","webkitRequest","mozRequest","oRequest","msRequest"],f=0,g=d.length;g>f;++f)if(h=d[f],i=b[h+"AnimationFrame"])return a(b,i);return c.warn("Can't find requestAnimationFrame in your browser. Use polyfill."),function(a){return b.setTimeout(a,e)}}),g={scrollProperty:"scroll",positionProperty:"position",horizontalScrolling:!0,verticalScrolling:!0,horizontalOffset:0,verticalOffset:0,responsive:!1,parallaxBackgrounds:!0,parallaxElements:!0,hideDistantElements:1,hideElement:function(a){a.addClass("ng-hide")},showElement:function(a){a.removeClass("ng-hide")},isElementHidden:function(a){return a.hasClass("ng-hide")}},h=function(){function b(a){this._$element=c(a),this._callbacks=[],this._props={}}b.displayName="Target";var f=b.prototype;return b._lastTime=0,b.handleUpdate=function(a){var b,c,d,f;if(b=a-this._lastTime<e)return!0;this._lastTime=a,c=!1;for(d in this)f=this[d],"function"==typeof f.handleUpdate&&f.handleUpdate(a)&&!c&&(c=!0);return c},f.isPropChanged=function(){var a;return a=this.getOffset(),a.scrollTop=this.getTop(),a.scrollLeft=this.getLeft(),angular.equals(a,this._props)?!1:(d(this._props,a),!0)},f.addCallbak=function(b){var c;return c=-1+this._callbacks.push(b),a(this._callbacks,this._callbacks.splice,c)},f.handleUpdate=function(){var a,b,c,d;if(this.isPropChanged())for(a=0,c=(b=this._callbacks).length;c>a;++a)(d=b[a])(this._props)},f.handleWebkitBug=function(){var a,b,c;a=this._props,b=a.scrollTop,c=a.scrollLeft,this.setTop(b+1),this.setLeft(c+1),this.setTop(b),this.setLeft(c)},f.getLeft=function(){return this._$element.prop("scrollLeft")},f.setLeft=function(a){this._$element.prop("scrollLeft",a)},f.getTop=function(){return this._$element.prop("scrollTop")},f.setTop=function(a){this._$element.prop("scrollTop",a)},b}(),i=["$window"].concat(function(a){return function(b,c){var d;return d=b[0],d.currentStyle?d.currentStyle[c]:a.getComputedStyle?a.getComputedStyle(d)[c]:d.style[c]}}),j=["$window","$document","$position","$requestAnimationFrame","$css","stellarConfig"].concat(function(b,c,e,f,g,i){var j,k,l,m,n,o;return j=h.window=new h(b),k=h.document=new h(c),l=!1,j.getOffset=k.getOffset=function(){var a;return a=c[0].documentElement,{height:a.clientHeight,width:a.clientWidth,top:0,left:0}},j.getLeft=k.getLeft=function(){return b.pageXOffset},j.getTop=k.getTop=function(){return b.pageYOffset},j.setLeft=k.setLeft=function(a){b.scrollTo(a,b.pageYOffset)},j.setTop=k.setLeft=function(a){b.scrollTo(b.pageXOffset,a)},m=i.scrollProperty,n=function(a){h.handleUpdate(a),o()},d(h.prototype,{getOffset:function(){return e.offset(this._$element)}},angular.isObject(m)?m:function(){var a;switch(a=function(a,b){return parseInt(g(a,b),10)},m){case"scroll":return n=function(a){h.handleUpdate(a)&&o()},{};case"position":return{getLeft:function(){return-1*a(this._$element,"left")},getTop:function(){return-1*a(this._$element,"top")}};case"margin":return{getLeft:function(){return-1*a(this._$element,"marginLeft")},getTop:function(){return-1*a(this._$element,"marginTop")}};case"transform":throw Error("unimplemented");default:throw Error("unimplemented")}}()),o=a(this,f,n),function(a,c){return o(),"scroll"!==m||l||(l=!0,angular.element(b).on("scroll resize",o)),h[a]||(h[a]=new h(c))}}),k=["$window","$position","$css","stellarTarget"].concat(function(a,b,c,d){var e,f;return e=function(a){var b;return b=c(a,"backgroundPosition").split(" "),[parseInt(b[0]),parseInt(b[1])]},f=function(a,b){var d,e;return d=b.stellarBackgroundRatio||1,e="fixed"===c(a,"backgroundAttachment")?0:1,e-d},{restrict:"A",link:function(c,h,i){var j,k,l,m,n,o;j=f(h,i),k=i.stellarVerticalOffset||g.verticalOffset,l=i.stellarHorizontalOffset||g.horizontalOffset,m=b.offset(h),n=e(h),o={top:0,left:0},m.bgTop=n[1],m.bgLeft=n[0],c.$on("$destroy",d("window",a).addCallbak(function(a){var b,c;b=j*(a.scrollTop+k-a.top-m.top+o.top-m.bgTop),c=j*(a.scrollLeft+l-a.left-m.left+o.left-m.bgLeft),h.css("background-position",c+"px "+b+"px")}))}}}),l=["$window","$css","$position","stellarConfig","stellarTarget"].concat(function(a,b,c,d,e){var f,g,h,i,j,k;return f=d.positionProperty,g=d.horizontalScrolling,h=d.verticalScrolling,i=angular.isFunction(f.setPosition)?f.setPosition:function(){var a,b;switch(f){case"position":a=function(a,b){a.css("top",b)},b=function(a,b){a.css("left",b)};break;case"transform":throw Error("unimplemented");default:throw Error("unimplemented")}return function(c,d,e,f,i){g&&b(c,d+"px",e+"px"),h&&a(c,f+"px",i+"px")}}(),j=function(a){return"fixed"===b(a,"position")},k=function(a,b){var c,d;return c=b.stellarRatio||1,d=j(a)?1:0,c+d-1},{restrict:"A",link:function(b,f,l){var m,n,o,p,q,r,s;m=j(f),n=-1*k(f,l),o=l.stellarVerticalOffset||d.verticalOffset,p=l.stellarHorizontalOffset||d.horizontalOffset,q=c.offset(f),r=c.position(f),s={top:0,left:0},q.positionTop=r.top,q.positionLeft=r.left,b.$on("$destroy",e("window",a).addCallbak(function(a){var b,c,e,j,k,l,r,t,u;b=q.positionTop,c=q.top,h&&(b+=n*(a.scrollTop+o+a.top+q.positionTop-q.top+s.top),c+=b-q.positionTop),e=q.positionLeft,j=q.left,g&&(e+=n*(a.scrollLeft+p+a.left+q.positionLeft-q.left+s.left),j+=e-q.positionLeft),d.hideDistantElements&&(k=m?0:a.scrollLeft,l=m?0:a.scrollTop,r=!g||j+q.width>k&&j<a.width+a.left+k,t=!h||c+q.height>l&&c<a.height+a.top+l),u=d.isElementHidden(f),r&&t?(u&&d.showElement(f),i(f,e,q.positionLeft,b,q.positionTop)):u||d.hideElement(f)}))}}}),angular.module("angular.stellar",["ui.bootstrap.position"]).constant("stellarConfig",g).factory("$requestAnimationFrame",f).factory("$css",i).factory("stellarTarget",j).directive("stellarRatio",l).directive("stellarBackgroundRatio",k)}).call(this);