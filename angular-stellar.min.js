/*! angular-stellar - v0.1.2 - 2014-01-05
 * https://github.com/tomchentw/angular-stellar
 * Copyright (c) 2014 [tomchentw](https://github.com/tomchentw/);
 * Licensed [MIT](http://tomchentw.mit-license.org/)
 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n={}.toString;a=angular.bind,b=angular.noop,c=angular.element,d=angular.extend,e=angular.equals,f=angular.isDefined,g=["$window","$log"].concat(function(b,c){var d,e,f,g,h;for(d=["request","webkitRequest","mozRequest","oRequest","msRequest"],e=0,f=d.length;f>e;++e)if(g=d[e],h=b[g+"AnimationFrame"])return a(b,h);return c.warn("Can't find requestAnimationFrame in your browser. Use polyfill."),function(a){return b.setTimeout(a,1e3/60)}}),h=["$window"].concat(function(a){return{adapter:function(b,c){var d;return d=b[0],d.currentStyle?d.currentStyle[c]:a.getComputedStyle?a.getComputedStyle(d)[c]:d.style[c]},toInt:function(a,b,c){return c||(c=0),parseInt(this.adapter(a,b),10)||c}}}),i={scrollProperty:"scroll",positionProperty:"position",horizontalScrolling:!0,verticalScrolling:!0,horizontalOffset:0,verticalOffset:0,responsive:!1,parallaxBackgrounds:!0,parallaxElements:!0,hideDistantElements:1,hideElement:function(a){a.addClass("ng-hide")},showElement:function(a){a.removeClass("ng-hide")},isElementHidden:function(a){return a.hasClass("ng-hide")}},j=function(){function f(a,b){h[a]=this,this._$element=c(b),this._callbacks=[],this._props={},this._lastTime=0}f.displayName="Target";var g=f.prototype,h=f;return g.isJustUpdated=function(a){var b;return(b=a-this._lastTime<1e3/60)?!0:(this._lastTime=a,!1)},g.isPropChanged=function(){var a;return a=this.getOffset(),a.scrollTop=this.getTop(),a.scrollLeft=this.getLeft(),e(a,this._props)?!1:(d(this._props,a),!0)},g.addCallbak=function(b){var c;return c=-1+this._callbacks.push(b),a(this._callbacks,this._callbacks.splice,c)},g.handleUpdate=function(a){var b,c,d,e;if(this.isJustUpdated(a))return!0;if(this.isPropChanged())for(b=0,d=(c=this._callbacks).length;d>b;++b)(e=c[b])(this._props)},g.handleWebkitBug=function(){var a,b,c;a=this._props,b=a.scrollTop,c=a.scrollLeft,this.setTop(b+1),this.setLeft(c+1),this.setTop(b),this.setLeft(c)},g.getLeft=b,g.setLeft=b,g.getTop=b,g.setTop=b,f}(),k=["$window","$position","$requestAnimationFrame","$css","stellarConfig"].concat(function(b,c,e,g,h){var i,k,l,m,o,p,q,r;return i=function(){switch(h.positionProperty){case"position":return{setTop:function(a,b){a.css("top",b)},setLeft:function(a,b){a.css("left",b)}};case"transform":throw Error("unimplemented");default:return h.positionProperty}}(),k=i.setPosition||function(a,b,c,d,e){h.horizontalScrolling&&i.setLeft(a,b+"px",c+"px"),h.verticalScrolling&&i.setTop(a,d+"px",e+"px")},l={get:function(a){var b;return console.log(n.call(g).slice(8,-1),n.call(g.adapter).slice(8,-1),g.adapter(a,"background-position")),b=g.adapter(a,"background-position").split(" "),[parseInt(b[0]),parseInt(b[1])]},set:function(a,b,c){a.css("background-position",b+" "+c)}},m=function(a){return b===a[0]||9===a.prop("nodeType")},o=function(){switch(h.scrollProperty){case"scroll":return{getLeft:function(){return this._$element.prop("scrollLeft")||b.pageXOffset},getTop:function(){return this._$element.prop("scrollTop")||b.pageYOffset},setLeft:function(a){m(this._$element)?b.scrollTo(a,b.pageYOffset):this._$element.prop("scrollLeft",a)},setTop:function(a){m(this._$element)?b.scrollTo(b.pageXOffset,a):this._$element.prop("scrollTop",a)}};case"position":return{getLeft:function(){return-1*g.toInt(this._$element,"left")},getTop:function(){return-1*g.toInt(this._$element,"top")}};case"margin":return{getLeft:function(){return-1*g.toInt(this._$element,"margin-left")},getTop:function(){return-1*g.toInt(this._$element,"margin-top")}};case"transform":throw Error("unimplemented");default:return h.scrollProperty}}(),d(j.prototype,{getOffset:function(){var a,b;return a=c.offset(this._$element),a.offsetTop=(b=a.top,delete a.top,b),a.offsetLeft=(b=a.left,delete a.left,b),a}},o),p=function(a){var b,c,d,e;b=!1;for(c in d=j)e=d[c],"function"==typeof e.handleUpdate&&e.handleUpdate(a)&&!b&&(b=!0,q())},q=function(){e(p)},r=new j("window",b),r._$element.on("scroll resize",q),r.getOffset=function(){var a;return a=b.document.documentElement,{height:a.clientHeight,width:a.clientWidth,offsetTop:0,offsetLeft:0}},/WebKit/.test(b.navigator.userAgent)&&r._$element.on("load",a(r,r.handleWebkitBug)),{get:function(a){var b,d,e;return b=c.position(a),d=c.offset(a),e=l.get(a),{height:b.height,width:b.width,positionTop:b.top,positionLeft:b.left,offsetTop:(null!=d?d.top:void 0)||0,offsetLeft:(null!=d?d.left:void 0)||0,bgTop:e[1],bgLeft:e[0]}},set:function(a,b){f(b.bgTop)&&f(b.bgLeft)&&l.set(a,b.bgLeft,b.bgTop),f(b.positionTop)&&f(b.positionLeft)&&k(a,b.positionLeft,b.startingLeft,b.positionTop,b.startingTop)},requestFrame:function(a,b){var c,d;return b||(b="window"),c=j[b]||new j(b),d=c.addCallbak(a),q(),d}}}),l=["$window","$document","$css","stellarAccessors"].concat(function(a,b,c,d){var e;return e=function(a,b){var d,e;return d=b.stellarBackgroundRatio||1,e="fixed"===c.adapter(a,"background-attachment")?0:1,e-d},{restrict:"A",link:function(a,b,c){var f,g,h,j,k;f=e(b,c),g=c.stellarVerticalOffset||i.verticalOffset,h=c.stellarHorizontalOffset||i.horizontalOffset,j=d.get(b),k={offsetTop:0,offsetLeft:0},a.$on("$destroy",d.requestFrame(function(a){var c,e;c=f*(a.scrollTop+g-a.offsetTop-j.offsetTop+k.offsetTop-j.bgTop),e=f*(a.scrollLeft+h-a.offsetLeft-j.offsetLeft+k.offsetLeft-j.bgLeft),d.set(b,{bgTop:c,bgLeft:e})}))}}}),m=["$window","$document","$css","stellarAccessors","stellarConfig"].concat(function(a,b,c,d,e){var f,g;return f=function(a){return"fixed"===c.adapter(a,"position")},g=function(a,b){var c,d;return c=b.stellarRatio||1,d=f(a)?1:0,c+d-1},{restrict:"A",link:function(a,b,c){var h,i,j,k,l,m;h=f(b),i=-1*g(b,c),j=c.stellarVerticalOffset||e.verticalOffset,k=c.stellarHorizontalOffset||e.horizontalOffset,l=d.get(b),m={offsetTop:0,offsetLeft:0},a.$on("$destroy",d.requestFrame(function(a){var c,f,g,n,o,p,q,r,s;c=l.positionTop,f=l.offsetTop,e.verticalScrolling&&(c+=i*(a.scrollTop+j+a.offsetTop+l.positionTop-l.offsetTop+m.offsetTop),f+=c-l.positionTop),g=l.positionLeft,n=l.offsetLeft,e.horizontalScrolling&&(g+=i*(a.scrollLeft+k+a.offsetLeft+l.positionLeft-l.offsetLeft+m.offsetLeft),n+=g-l.positionLeft),e.hideDistantElements&&(o=h?0:a.scrollLeft,p=h?0:a.scrollTop,q=!e.horizontalScrolling||n+l.width>o&&n<a.width+a.offsetLeft+o,r=!e.verticalScrolling||f+l.height>p&&f<a.height+a.offsetTop+p),s=e.isElementHidden(b),q&&r?(s&&e.showElement(b),d.set(b,{positionTop:c,positionLeft:g,startingTop:l.positionTop,startingLeft:l.positionLeft})):s||e.hideElement(b)}))}}}),angular.module("angular.stellar",["ui.bootstrap.position"]).constant("stellarConfig",i).factory("$requestAnimationFrame",g).factory("$css",h).factory("stellarAccessors",k).directive("stellarRatio",m).directive("stellarBackgroundRatio",l)}).call(this);