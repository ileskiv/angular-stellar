/*! angular-stellar - v0.2.0 - 2014-01-11
 * https://github.com/tomchentw/angular-stellar
 * Copyright (c) 2014 [tomchentw](https://github.com/tomchentw/);
 * Licensed [MIT](http://tomchentw.mit-license.org/)
 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;a=angular.bind,b=angular.noop,c=angular.element,d=angular.extend,e=1e3/60,f=["$window","$log"].concat(function(b,c){var d,f,g,h,i;for(d=["request","webkitRequest","mozRequest","oRequest","msRequest"],f=0,g=d.length;g>f;++f)if(h=d[f],i=b[h+"AnimationFrame"])return a(b,i);return c.warn("Can't find requestAnimationFrame in your browser. Use polyfill."),function(a){return b.setTimeout(a,e)}}),g={scrollProperty:"scroll",positionProperty:"position",horizontalScrolling:!0,verticalScrolling:!0,horizontalOffset:0,verticalOffset:0,responsive:!1,parallaxBackgrounds:!0,parallaxElements:!0,hideDistantElements:1,hideElement:function(a){a.addClass("ng-hide")},showElement:function(a){a.removeClass("ng-hide")},isElementHidden:function(a){return a.hasClass("ng-hide")}},h=function(){function b(a){this._$element=c(a),this._callbacks=[],this._props={}}b.displayName="Target";var f=b.prototype;return b._lastTime=0,b.handleUpdate=function(a){var b,c,d,f;if(b=a-this._lastTime<e)return!0;this._lastTime=a,c=!1;for(d in this)f=this[d],"function"==typeof f.handleUpdate&&f.handleUpdate(a)&&!c&&(c=!0);return c},f.isPropChanged=function(){var a;return a=this.getOffset(),a.scrollTop=this.getTop(),a.scrollLeft=this.getLeft(),angular.equals(a,this._props)?!1:(d(this._props,a),!0)},f.addCallbak=function(b){var c;return c=-1+this._callbacks.push(b),a(this._callbacks,this._callbacks.splice,c)},f.handleUpdate=function(){var a,b,c,d;if(this.isPropChanged())for(a=0,c=(b=this._callbacks).length;c>a;++a)(d=b[a])(this._props)},f.handleWebkitBug=function(){var a,b,c;a=this._props,b=a.scrollTop,c=a.scrollLeft,this.setTop(b+1),this.setLeft(c+1),this.setTop(b),this.setLeft(c)},f.getLeft=function(){return this._$element.prop("scrollLeft")},f.setLeft=function(a){this._$element.prop("scrollLeft",a)},f.getTop=function(){return this._$element.prop("scrollTop")},f.setTop=function(a){this._$element.prop("scrollTop",a)},b}(),i=["$window"].concat(function(a){return function(b,c){var d,e;return d=b[0],e=d.currentStyle?d.currentStyle:a.getComputedStyle?a.getComputedStyle(d):d.style,c?e[c]:e}}),j=["$css"].concat(function(a){var b,c,d,e;b=/^(moz|webkit|khtml|o|ms)(?=[A-Z])/;for(c in a(angular.element("<script></script>")))if(d=c.match(b)){e=d[0];break}return function(a){return e+(e?angular.uppercase(a.charAt(0))+""+a.slice(1):a)}}),k=["$window","$document","$position","$requestAnimationFrame","$css","$vendorPrefix","stellarConfig"].concat(function(b,c,e,f,g,i,j){var k,l,m,n,o,p;return k=h.window=new h(b),l=h.document=new h(c),m=!1,k.getOffset=l.getOffset=function(){var a;return a=c[0].documentElement,{height:a.clientHeight,width:a.clientWidth,top:0,left:0}},k.getLeft=l.getLeft=function(){return b.pageXOffset},k.getTop=l.getTop=function(){return b.pageYOffset},k.setLeft=l.setLeft=function(a){b.scrollTo(a,b.pageYOffset)},k.setTop=l.setLeft=function(a){b.scrollTo(b.pageXOffset,a)},n=j.scrollProperty,o=function(a){h.handleUpdate(a),p()},d(h.prototype,{getOffset:function(){return e.offset(this._$element)}},angular.isObject(n)?n:function(){var a,b;switch(a=function(a,b){return parseInt(g(a,b),10)},b=i("transform"),n){case"scroll":return o=function(a){h.handleUpdate(a)&&p()},{};case"position":return{getLeft:function(){return-1*a(this._$element,"left")},getTop:function(){return-1*a(this._$element,"top")}};case"margin":return{getLeft:function(){return-1*a(this._$element,"marginLeft")},getTop:function(){return-1*a(this._$element,"marginTop")}};case"transform":return{getLeft:function(){var a;return a=g(this._$element,b),"none"===a?0:-1*parseInt(a.match(/(-?[0-9]+)/g)[4],10)},getTop:function(){var a;return a=g(this._$element,b),"none"===a?0:-1*parseInt(a.match(/(-?[0-9]+)/g)[5],10)}};default:throw Error("unimplemented")}}()),p=a(this,f,o),function(a,c){return p(),"scroll"!==n||m||(m=!0,angular.element(b).on("scroll resize",p)),h[a]||(h[a]=new h(c))}}),l=["$window","$position","$css","stellarTarget"].concat(function(a,b,c,d){var e,f;return e=function(a){var b;return b=c(a,"backgroundPosition").split(" "),[parseInt(b[0]),parseInt(b[1])]},f=function(a,b){var d,e;return d=b.stellarBackgroundRatio||1,e="fixed"===c(a,"backgroundAttachment")?0:1,e-d},{restrict:"A",link:function(c,h,i){var j,k,l,m,n,o;j=f(h,i),k=i.stellarVerticalOffset||g.verticalOffset,l=i.stellarHorizontalOffset||g.horizontalOffset,m=b.offset(h),n=e(h),o={top:0,left:0},m.bgTop=n[1],m.bgLeft=n[0],c.$on("$destroy",d("window",a).addCallbak(function(a){var b,c;b=j*(a.scrollTop+k-a.top-m.top+o.top-m.bgTop),c=j*(a.scrollLeft+l-a.left-m.left+o.left-m.bgLeft),h.css("background-position",c+"px "+b+"px")}))}}}),m=["$window","$css","$vendorPrefix","$position","stellarConfig","stellarTarget"].concat(function(a,b,c,d,e,f){var g,h,i,j,k,l;return g=e.positionProperty,h=e.horizontalScrolling,i=e.verticalScrolling,j=angular.isFunction(g.setPosition)?g.setPosition:function(){var a,b,d;switch(a=c("transform"),g){case"position":b=function(a,b){a.css("top",b)},d=function(a,b){a.css("left",b)};break;case"transform":return function(b,c,d,e,f){b.css(a,"translate3d("+(c-d)+"px, "+(e-f)+"px, 0)")};default:throw Error("unimplemented")}return function(a,c,e,f,g){h&&d(a,c+"px",e+"px"),i&&b(a,f+"px",g+"px")}}(),k=function(a){return"fixed"===b(a,"position")},l=function(a,b){var c,d;return c=b.stellarRatio||1,d=k(a)?1:0,c+d-1},{restrict:"A",link:function(b,c,g){var m,n,o,p,q,r,s;m=k(c),n=-1*l(c,g),o=g.stellarVerticalOffset||e.verticalOffset,p=g.stellarHorizontalOffset||e.horizontalOffset,q=d.offset(c),r=d.position(c),s={top:0,left:0},q.positionTop=r.top,q.positionLeft=r.left,b.$on("$destroy",f("window",a).addCallbak(function(a){var b,d,f,g,k,l,r,t,u;b=q.positionTop,d=q.top,i&&(b+=n*(a.scrollTop+o+a.top+q.positionTop-q.top+s.top),d+=b-q.positionTop),f=q.positionLeft,g=q.left,h&&(f+=n*(a.scrollLeft+p+a.left+q.positionLeft-q.left+s.left),g+=f-q.positionLeft),e.hideDistantElements&&(k=m?0:a.scrollLeft,l=m?0:a.scrollTop,r=!h||g+q.width>k&&g<a.width+a.left+k,t=!i||d+q.height>l&&d<a.height+a.top+l),u=e.isElementHidden(c),r&&t?(u&&e.showElement(c),j(c,f,q.positionLeft,b,q.positionTop)):u||e.hideElement(c)}))}}}),angular.module("angular.stellar",["ui.bootstrap.position"]).constant("stellarConfig",g).factory("$requestAnimationFrame",f).factory("$css",i).factory("$vendorPrefix",j).factory("stellarTarget",k).directive("stellarRatio",m).directive("stellarBackgroundRatio",l)}).call(this);